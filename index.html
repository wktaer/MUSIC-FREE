<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicApp</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/player.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="light-mode">
    <!-- Sección principal: Grid de álbumes -->
    <section id="main-view" class="view-section active-view">
        <header>
            <div class="header-content">
                <h1>MusicApp</h1>
                <div class="header-controls">
                    <button id="theme-toggle" aria-label="Cambiar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="search-container">
                        <input type="text" id="search" placeholder="Buscar álbumes, artistas...">
                        <i class="fas fa-search"></i>
                    </div>
                    <button id="storage-btn" class="secondary-btn small-btn">
                        <i class="fas fa-database"></i> Almacenamiento
                    </button>
                    <button id="add-album-btn" class="primary-btn">
                        <i class="fas fa-plus"></i> Añadir Álbum
                    </button>
                </div>
            </div>
        </header>

        <main>
            <section class="albums-container" id="albums-grid">
                <!-- Los álbumes se cargarán dinámicamente aquí -->
            </section>
        </main>
    </section>

    <!-- Sección de vista detallada de álbum -->
    <section id="album-detail-view" class="view-section">
        <header>
            <div class="header-content detail-header">
                <button id="back-to-grid" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 id="detail-header-title">Detalles del Álbum</h1>
                <div class="header-actions">
                    <button id="detail-theme-toggle" aria-label="Cambiar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </header>

        <main>
            <div class="album-detail-view">
                <div class="album-detail-header">
                    <div class="album-detail-cover-container">
                        <img id="detail-cover" src="images/placeholder.jpg" alt="Portada del álbum" class="album-detail-cover">
                    </div>
                    <div class="album-detail-info">
                        <h2 id="detail-title" class="detail-title"></h2>
                        <p id="detail-artist" class="detail-artist"></p>
                        <p id="detail-year" class="detail-year"></p>
                        <div class="album-detail-actions">
                            <button id="play-album-btn" class="primary-btn">
                                <i class="fas fa-play"></i> Reproducir Álbum
                            </button>
                            <button id="edit-album-btn" class="secondary-btn">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button id="delete-album-btn" class="danger-btn">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                </div>
                <div class="album-detail-tracks">
                    <div class="tracks-header">
                        <h3>Canciones</h3>
                        <button id="add-track-to-album-btn" class="secondary-btn small-btn">
                            <i class="fas fa-plus"></i> Añadir Canción
                        </button>
                    </div>
                    <div id="detail-tracks-list" class="tracks-list">
                        <!-- Las pistas se cargarán dinámicamente aquí -->
                    </div>
                </div>
            </div>
        </main>
    </section>

    <!-- Vista de almacenamiento local -->
    <section id="storage-view" class="view-section">
        <header>
            <div class="header-content detail-header">
                <button id="back-from-storage" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>Almacenamiento Local</h1>
                <div class="header-actions">
                    <button id="storage-theme-toggle" aria-label="Cambiar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </header>
        <main>
            <div class="storage-stats-container">
                <div class="storage-stats-card">
                    <div class="storage-icon">
                        <i class="fas fa-music"></i>
                    </div>
                    <div class="storage-info">
                        <h3>Total de canciones</h3>
                        <p id="total-tracks-count">0</p>
                    </div>
                </div>

                <div class="storage-stats-card">
                    <div class="storage-icon">
                        <i class="fas fa-compact-disc"></i>
                    </div>
                    <div class="storage-info">
                        <h3>Total de álbumes</h3>
                        <p id="total-albums-count">0</p>
                    </div>
                </div>

                <div class="storage-stats-card">
                    <div class="storage-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="storage-info">
                        <h3>Espacio utilizado</h3>
                        <p id="storage-used">0 MB</p>
                    </div>
                </div>
            </div>

            <div class="storage-actions">
                <button id="clear-storage-btn" class="danger-btn">
                    <i class="fas fa-trash"></i> Eliminar todos los datos
                </button>
            </div>
        </main>
    </section>

    <!-- Reproductor de audio (fijo en parte inferior) -->
    <footer class="player" id="player">
        <div class="current-song-info">
            <img src="images/placeholder.jpg" alt="Portada del álbum" id="current-artwork" class="player-cover">
            <div class="player-title-artist">
                <span id="current-song-title" class="player-song-title">No hay canción seleccionada</span>
                <span id="current-song-artist" class="player-artist-name">Selecciona un álbum para comenzar</span>
            </div>
        </div>

        <div class="player-controls">
            <div class="progress-container" id="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
                <div class="progress-handle" id="progress-handle"></div>
            </div>
            <div class="song-time">
                <span id="current-time">0:00</span>
                <span id="total-time">0:00</span>
            </div>
            <div class="control-buttons">
                <button id="prev-btn" class="control-btn">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button id="play-pause-btn" class="control-btn play-pause-btn">
                    <i class="fas fa-play" id="play-icon"></i>
                </button>
                <button id="next-btn" class="control-btn">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
        </div>

        <div class="volume-control">
            <i class="fas fa-volume-up volume-icon" id="volume-icon"></i>
            <div class="volume-slider" id="volume-slider">
                <div class="volume-level" id="volume-level"></div>
            </div>
        </div>

        <audio id="audio-player"></audio>
    </footer>

    <!-- Modal para añadir álbumes -->
    <div id="add-album-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Añadir Nuevo Álbum</h2>
                <span class="close">&times;</span>
            </div>
            <form id="album-form">
                <div class="form-group">
                    <label for="album-cover">Portada del Álbum:</label>
                    <div class="cover-upload">
                        <img id="cover-preview" src="images/placeholder.jpg" alt="Vista previa">
                        <div class="upload-controls">
                            <label for="album-cover" class="file-upload-btn">
                                <i class="fas fa-upload"></i> Seleccionar imagen
                            </label>
                            <input type="file" id="album-cover" accept="image/*" required>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="album-title">Título del Álbum:</label>
                    <input type="text" id="album-title" required>
                </div>
                <div class="form-group">
                    <label for="album-artist">Artista:</label>
                    <input type="text" id="album-artist" required>
                </div>
                <div class="form-group">
                    <label for="album-year">Año:</label>
                    <input type="number" id="album-year" min="1900" max="2099" required>
                </div>
                <div class="form-group">
                    <label for="album-tracks">Canciones:</label>
                    <div id="tracks-container">
                        <!-- Las pistas se añadirán aquí -->
                    </div>
                    <button type="button" id="add-track-btn" class="secondary-btn">
                        <i class="fas fa-plus"></i> Añadir Canción
                    </button>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary-btn full-width-btn">Guardar Álbum</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Editar Álbum -->
    <div id="edit-album-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Álbum</h2>
                <span class="close">&times;</span>
            </div>
            <form id="edit-album-form">
                <input type="hidden" id="edit-album-id">
                <div class="form-group">
                    <label for="edit-album-cover">Portada del Álbum:</label>
                    <div class="cover-upload">
                        <img id="edit-cover-preview" src="images/placeholder.jpg" alt="Vista previa">
                        <div class="upload-controls">
                            <label for="edit-album-cover" class="file-upload-btn">
                                <i class="fas fa-upload"></i> Cambiar imagen
                            </label>
                            <input type="file" id="edit-album-cover" accept="image/*">
                            <small>Deja vacío para mantener la portada actual</small>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-album-title">Título del Álbum:</label>
                    <input type="text" id="edit-album-title" required>
                </div>
                <div class="form-group">
                    <label for="edit-album-artist">Artista:</label>
                    <input type="text" id="edit-album-artist" required>
                </div>
                <div class="form-group">
                    <label for="edit-album-year">Año:</label>
                    <input type="number" id="edit-album-year" min="1900" max="2099" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary-btn full-width-btn">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Editar Pista -->
    <div id="edit-track-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Pista</h2>
                <span class="close">&times;</span>
            </div>
            <form id="edit-track-form">
                <input type="hidden" id="edit-track-id">
                <input type="hidden" id="edit-track-album-id">
                <div class="form-group">
                    <label for="edit-track-title">Título de la Pista:</label>
                    <input type="text" id="edit-track-title" required>
                </div>
                <div class="form-group">
                    <label for="edit-track-file">Archivo de Audio:</label>
                    <div class="file-upload-container">
                        <label for="edit-track-file" class="file-upload-btn">
                            <i class="fas fa-upload"></i> Seleccionar audio
                        </label>
                        <input type="file" id="edit-track-file" accept="audio/*">
                        <small id="edit-track-filename">Deja vacío para mantener el audio actual</small>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary-btn full-width-btn">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Añadir Pista a un Álbum Existente -->
    <div id="add-track-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Añadir Nueva Pista</h2>
                <span class="close">&times;</span>
            </div>
            <form id="add-track-form">
                <input type="hidden" id="add-track-album-id">
                <div class="form-group">
                    <label for="add-track-title">Título de la Pista:</label>
                    <input type="text" id="add-track-title" required>
                </div>
                <div class="form-group">
                    <label for="add-track-file">Archivo de Audio:</label>
                    <div class="file-upload-container">
                        <label for="add-track-file" class="file-upload-btn">
                            <i class="fas fa-upload"></i> Seleccionar audio
                        </label>
                        <input type="file" id="add-track-file" accept="audio/*" required>
                        <small id="add-track-filename">Ningún archivo seleccionado</small>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary-btn full-width-btn">Añadir Pista</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Plantilla para nuevas pistas (no visible) -->
    <template id="track-template">
        <div class="track-item">
            <div class="track-details">
                <input type="text" class="track-title-input" placeholder="Título de la canción" required>
                <div class="file-upload-container">
                    <label for="track-file-${index}" class="file-upload-btn">
                        <i class="fas fa-upload"></i> Seleccionar audio
                    </label>
                    <input type="file" id="track-file-${index}" class="track-file" accept="audio/*" required>
                    <small class="track-filename">Ningún archivo seleccionado</small>
                </div>
            </div>
            <button type="button" class="remove-track-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </template>

    <!-- Plantilla para item en la lista de pistas (vista detallada) -->
    <template id="track-list-item-template">
        <div class="track-list-item">
            <div class="track-number"></div>
            <div class="track-info">
                <span class="track-list-title"></span>
            </div>
            <div class="track-actions">
                <button class="track-play-btn control-btn">
                    <i class="fas fa-play"></i>
                </button>
                <button class="track-edit-btn control-btn">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="track-delete-btn control-btn">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </template>

    <!-- Confirmación de eliminación -->
    <div id="confirm-delete-modal" class="modal">
        <div class="modal-content confirm-modal">
            <h3 id="confirm-delete-message">¿Estás seguro de que quieres eliminar este elemento?</h3>
            <div class="confirm-actions">
                <button id="confirm-delete-cancel" class="secondary-btn">Cancelar</button>
                <button id="confirm-delete-confirm" class="danger-btn">Eliminar</button>
            </div>
        </div>
    </div>

    <script src="js/db.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/player.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
