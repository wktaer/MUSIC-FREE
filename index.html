<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicApp</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/player.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="light-mode">
    <!-- Sección principal: Grid de álbumes -->
    <section id="main-view" class="view-section active-view">
        <header>
            <div class="header-content">
                <h1>MusicApp</h1>
                <div class="header-controls">
                    <div class="search-container">
                        <input type="text" id="search" placeholder="Buscar álbumes, artistas...">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="button-group">
                        <button id="theme-toggle" aria-label="Cambiar tema">
                            <i class="fas fa-moon"></i>
                        </button>
                        <button id="profile-btn" class="secondary-btn small-btn">
                            <i class="fas fa-user"></i> Perfil
                        </button>
                        <button id="storage-btn" class="secondary-btn small-btn">
                            <i class="fas fa-database"></i> Almacenamiento
                        </button>
                        <button id="settings-btn" class="secondary-btn small-btn">
                            <i class="fas fa-cog"></i> Configuración
                        </button>
                    </div>
                    <button id="add-album-btn" class="primary-btn">
                        <i class="fas fa-plus"></i> Añadir Álbum
                    </button>
                </div>
            </div>
        </header>

        <main>
            <section class="albums-container" id="albums-grid">
                <!-- Los álbumes se cargarán dinámicamente aquí -->
            </section>
        </main>
    </section>

    <!-- Sección de vista detallada de álbum -->
    <section id="album-detail-view" class="view-section">
        <header>
            <div class="header-content detail-header">
                <button id="back-to-grid" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 id="detail-header-title">Detalles del Álbum</h1>
                <div class="header-actions">
                    <button id="detail-theme-toggle" aria-label="Cambiar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </header>

        <main>
            <div class="album-detail-view">
                <div class="album-detail-header">
                    <div class="album-detail-cover-container">
                        <img id="detail-cover" src="images/placeholder.jpg" alt="Portada del álbum" class="album-detail-cover">
                    </div>
                    <div class="album-detail-info">
                        <h2 id="detail-title" class="detail-title"></h2>
                        <p id="detail-artist" class="detail-artist"></p>
                        <p id="detail-year" class="detail-year"></p>
                        <div class="album-detail-actions">
                            <button id="play-album-btn" class="primary-btn">
                                <i class="fas fa-play"></i> Reproducir Álbum
                            </button>
                            <button id="edit-album-btn" class="secondary-btn">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button id="delete-album-btn" class="danger-btn">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                </div>
                <div class="album-detail-tracks">
                    <div class="tracks-header">
                        <h3>Canciones</h3>
                        <button id="add-track-to-album-btn" class="secondary-btn small-btn">
                            <i class="fas fa-plus"></i> Añadir Canción
                        </button>
                    </div>
                    <div id="detail-tracks-list" class="tracks-list">
                        <!-- Las pistas se cargarán dinámicamente aquí -->
                    </div>
                </div>
                <!-- Información del usuario que subió el álbum -->
                <div class="album-uploader-info">
                    <p>Este álbum fue subido por: <a href="#" id="album-uploader" class="user-profile-link">Usuario</a></p>
                    <div class="uploader-actions">
                        <button id="view-profile-btn" class="secondary-btn small-btn">
                            <i class="fas fa-user"></i> Ver Perfil
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </section>

    <!-- Vista de almacenamiento local -->
    <section id="storage-view" class="view-section">
        <header>
            <div class="header-content detail-header">
                <button id="back-from-storage" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>Almacenamiento Local</h1>
                <div class="header-actions">
                    <button id="storage-theme-toggle" aria-label="Cambiar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </header>
        <main>
            <div class="storage-stats-container">
                <div class="storage-stats-card">
                    <div class="storage-icon">
                        <i class="fas fa-music"></i>
                    </div>
                    <div class="storage-info">
                        <h3>Total de canciones</h3>
                        <p id="total-tracks-count">0</p>
                    </div>
                </div>

                <div class="storage-stats-card">
                    <div class="storage-icon">
                        <i class="fas fa-compact-disc"></i>
                    </div>
                    <div class="storage-info">
                        <h3>Total de álbumes</h3>
                        <p id="total-albums-count">0</p>
                    </div>
                </div>

                <div class="storage-stats-card">
                    <div class="storage-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="storage-info">
                        <h3>Espacio utilizado</h3>
                        <p id="storage-used">0 MB</p>
                    </div>
                </div>
            </div>

            <div class="storage-actions">
                <button id="clear-storage-btn" class="danger-btn">
                    <i class="fas fa-trash"></i> Eliminar todos los datos
                </button>
            </div>
        </main>
    </section>

    <!-- Reproductor de audio (fijo en parte inferior) -->
    <footer class="player" id="player">
        <div class="current-song-info">
            <img src="images/placeholder.jpg" alt="Portada del álbum" id="current-artwork" class="player-cover">
            <div class="player-title-artist">
                <div class="now-playing-label">Reproduciendo</div>
                <h3 id="current-song-title">Selecciona una canción</h3>
                <p id="current-song-artist">Artista</p>
            </div>
        </div>

        <div class="player-progress">
            <span id="current-time">0:00</span>
            <div id="progress-container" class="progress-container">
                <div id="progress-bar" class="progress-bar"></div>
                <div id="progress-handle" class="progress-handle"></div>
            </div>
            <span id="total-time">0:00</span>
        </div>

        <div class="player-controls">
            <div class="main-controls">
                <button id="prev-btn" class="control-btn" title="Canción anterior" aria-label="Canción anterior">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button id="backward-btn" class="control-btn skip-back-10" title="Retroceder 10 segundos" aria-label="Retroceder 10 segundos">
                    <i class="fas fa-undo"></i>
                    <span class="skip-text">10</span>
                </button>
                <button id="play-pause-btn" class="control-btn play-btn" title="Reproducir/Pausar" aria-label="Reproducir o pausar">
                    <i class="fas fa-play" id="play-icon"></i>
                </button>
                <button id="forward-btn" class="control-btn skip-forward-10" title="Adelantar 10 segundos" aria-label="Adelantar 10 segundos">
                    <i class="fas fa-redo"></i>
                    <span class="skip-text">10</span>
                </button>
                <button id="next-btn" class="control-btn" title="Siguiente canción" aria-label="Siguiente canción">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>

            <div class="volume-control">
                <i class="fas fa-volume-up volume-icon" id="volume-icon" title="Volumen"></i>
                <div class="volume-slider" id="volume-slider" title="Ajustar volumen">
                    <div class="volume-level" id="volume-level"></div>
                </div>
            </div>
        </div>

        <audio id="audio-player"></audio>
    </footer>

    <!-- Modal para añadir álbumes -->
    <div id="add-album-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Añadir Nuevo Álbum</h2>
                <span class="close">&times;</span>
            </div>
            <form id="album-form">
                <div class="form-group">
                    <label for="album-cover">Portada del Álbum:</label>
                    <div class="cover-upload">
                        <img id="cover-preview" src="images/placeholder.jpg" alt="Vista previa">
                        <div class="upload-controls">
                            <label for="album-cover" class="file-upload-btn">
                                <i class="fas fa-upload"></i> Seleccionar imagen
                            </label>
                            <input type="file" id="album-cover" accept="image/*" required>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="album-title">Título del Álbum:</label>
                    <input type="text" id="album-title" required>
                </div>
                <div class="form-group">
                    <label for="album-artist">Artista:</label>
                    <input type="text" id="album-artist" required>
                </div>
                <div class="form-group">
                    <label for="album-year">Año:</label>
                    <input type="number" id="album-year" min="1900" max="2099" required>
                </div>
                <div class="form-group">
                    <label for="album-tracks">Canciones:</label>
                    <div id="tracks-container">
                        <!-- Las pistas se añadirán aquí -->
                    </div>
                    <button type="button" id="add-track-btn" class="secondary-btn">
                        <i class="fas fa-plus"></i> Añadir Canción
                    </button>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary-btn full-width-btn">Guardar Álbum</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Editar Álbum -->
    <div id="edit-album-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Álbum</h2>
                <span class="close">&times;</span>
            </div>
            <form id="edit-album-form">
                <input type="hidden" id="edit-album-id">
                <div class="form-group">
                    <label for="edit-album-cover">Portada del Álbum:</label>
                    <div class="cover-upload">
                        <img id="edit-cover-preview" src="images/placeholder.jpg" alt="Vista previa">
                        <div class="upload-controls">
                            <label for="edit-album-cover" class="file-upload-btn">
                                <i class="fas fa-upload"></i> Cambiar imagen
                            </label>
                            <input type="file" id="edit-album-cover" accept="image/*">
                            <small>Deja vacío para mantener la portada actual</small>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-album-title">Título del Álbum:</label>
                    <input type="text" id="edit-album-title" required>
                </div>
                <div class="form-group">
                    <label for="edit-album-artist">Artista:</label>
                    <input type="text" id="edit-album-artist" required>
                </div>
                <div class="form-group">
                    <label for="edit-album-year">Año:</label>
                    <input type="number" id="edit-album-year" min="1900" max="2099" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary-btn full-width-btn">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Editar Pista -->
    <div id="edit-track-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Pista</h2>
                <span class="close">&times;</span>
            </div>
            <form id="edit-track-form">
                <input type="hidden" id="edit-track-id">
                <input type="hidden" id="edit-track-album-id">
                <div class="form-group">
                    <label for="edit-track-title">Título de la Pista:</label>
                    <input type="text" id="edit-track-title" required>
                </div>
                <div class="form-group">
                    <label for="edit-track-file">Archivo de Audio:</label>
                    <div class="file-upload-container">
                        <label for="edit-track-file" class="file-upload-btn">
                            <i class="fas fa-upload"></i> Seleccionar audio
                        </label>
                        <input type="file" id="edit-track-file" accept="audio/*">
                        <small id="edit-track-filename">Deja vacío para mantener el audio actual</small>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary-btn full-width-btn">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Añadir Pista a un Álbum Existente -->
    <div id="add-track-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Añadir Nueva Pista</h2>
                <span class="close">&times;</span>
            </div>
            <form id="add-track-form">
                <input type="hidden" id="add-track-album-id">
                <div class="form-group">
                    <label for="add-track-title">Título de la Pista:</label>
                    <input type="text" id="add-track-title" required>
                </div>
                <div class="form-group">
                    <label for="add-track-file">Archivo de Audio:</label>
                    <div class="file-upload-container">
                        <label for="add-track-file" class="file-upload-btn">
                            <i class="fas fa-upload"></i> Seleccionar audio
                        </label>
                        <input type="file" id="add-track-file" accept="audio/*" required>
                        <small id="add-track-filename">Ningún archivo seleccionado</small>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary-btn full-width-btn">Añadir Pista</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Configuración -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configuración</h2>
                <span class="close">&times;</span>
            </div>
            <div class="settings-container">
                <div class="settings-section">
                    <h3>Reproducción</h3>
                    <div class="setting-item">
                        <label for="autoplay-setting">
                            <span>Reproducción automática</span>
                            <span class="setting-description">Reproducir automáticamente al abrir un álbum</span>
                        </label>
                        <div class="toggle-switch">
                            <input type="checkbox" id="autoplay-setting">
                            <span class="toggle-slider"></span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="skip-seconds">
                            <span>Segundos de salto</span>
                            <span class="setting-description">Segundos al avanzar/retroceder</span>
                        </label>
                        <input type="number" id="skip-seconds" min="5" max="60" step="5" value="10" class="setting-input">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Ecualizador</h3>
                    <div class="equalizer-container">
                        <div class="eq-slider-group">
                            <label for="eq-bass">Graves</label>
                            <input type="range" id="eq-bass" class="eq-slider" min="-12" max="12" value="0" step="1">
                            <span class="eq-value" id="eq-bass-value">0 dB</span>
                        </div>
                        <div class="eq-slider-group">
                            <label for="eq-mid">Medios</label>
                            <input type="range" id="eq-mid" class="eq-slider" min="-12" max="12" value="0" step="1">
                            <span class="eq-value" id="eq-mid-value">0 dB</span>
                        </div>
                        <div class="eq-slider-group">
                            <label for="eq-treble">Agudos</label>
                            <input type="range" id="eq-treble" class="eq-slider" min="-12" max="12" value="0" step="1">
                            <span class="eq-value" id="eq-treble-value">0 dB</span>
                        </div>
                        <div class="eq-preset-container">
                            <label>Presets</label>
                            <div class="eq-presets">
                                <button class="eq-preset-btn" data-preset="flat">Plano</button>
                                <button class="eq-preset-btn" data-preset="bass">Graves</button>
                                <button class="eq-preset-btn" data-preset="vocal">Vocal</button>
                                <button class="eq-preset-btn" data-preset="rock">Rock</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Notificaciones</h3>
                    <div class="setting-item">
                        <label for="notifications-position">
                            <span>Posición</span>
                            <span class="setting-description">Dónde mostrar las notificaciones</span>
                        </label>
                        <select id="notifications-position" class="setting-select">
                            <option value="top-right">Superior derecha</option>
                            <option value="top-left">Superior izquierda</option>
                            <option value="bottom-right" selected>Inferior derecha</option>
                            <option value="bottom-left">Inferior izquierda</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="notification-duration">
                            <span>Duración</span>
                            <span class="setting-description">Tiempo en pantalla (ms)</span>
                        </label>
                        <select id="notification-duration" class="setting-select">
                            <option value="2000">2 segundos</option>
                            <option value="3000" selected>3 segundos</option>
                            <option value="5000">5 segundos</option>
                        </select>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Interfaz</h3>
                    <div class="setting-item">
                        <label for="compact-mode-setting">
                            <span>Modo compacto</span>
                            <span class="setting-description">Interfaz más compacta para móviles</span>
                        </label>
                        <div class="toggle-switch">
                            <input type="checkbox" id="compact-mode-setting">
                            <span class="toggle-slider"></span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="animations-setting">
                            <span>Animaciones</span>
                            <span class="setting-description">Efectos de animación al cambiar canciones</span>
                        </label>
                        <div class="toggle-switch">
                            <input type="checkbox" id="animations-setting" checked>
                            <span class="toggle-slider"></span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="theme-mode">
                            <span>Tema</span>
                            <span class="setting-description">Aspecto visual de la aplicación</span>
                        </label>
                        <select id="theme-mode" class="setting-select">
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                            <option value="auto">Automático (según sistema)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="accent-color">
                            <span>Color de acento</span>
                            <span class="setting-description">Color principal de la interfaz</span>
                        </label>
                        <div class="color-picker-container">
                            <input type="color" id="accent-color" value="#0d6efd" class="color-picker">
                            <button id="reset-accent-color" class="small-btn secondary-btn">Restablecer</button>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Visualización</h3>
                    <div class="setting-item">
                        <label for="visualizer-enabled">
                            <span>Visualizador de audio</span>
                            <span class="setting-description">Mostrar efectos visuales durante la reproducción</span>
                        </label>
                        <div class="toggle-switch">
                            <input type="checkbox" id="visualizer-enabled" checked>
                            <span class="toggle-slider"></span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="visualizer-type">
                            <span>Tipo de visualizador</span>
                            <span class="setting-description">Efecto visual durante la reproducción</span>
                        </label>
                        <select id="visualizer-type" class="setting-select">
                            <option value="bars">Barras</option>
                            <option value="waves">Ondas</option>
                            <option value="circle">Círculo</option>
                            <option value="none">Ninguno</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="transition-effect">
                            <span>Efecto de transición</span>
                            <span class="setting-description">Animación al cambiar de canción</span>
                        </label>
                        <select id="transition-effect" class="setting-select">
                            <option value="fade">Desvanecer</option>
                            <option value="slide">Deslizar</option>
                            <option value="zoom">Zoom</option>
                            <option value="none">Ninguno</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de perfil de usuario -->
    <div id="user-profile-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-profile-modal">&times;</span>
            <h2>Perfil de Usuario</h2>
            <div id="profile-view" class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar-container">
                        <img id="profile-avatar" src="images/placeholder.jpg" alt="Avatar de perfil" class="profile-avatar">
                    </div>
                    <div class="profile-info">
                        <h3 id="profile-username">Nombre de Usuario</h3>
                        <p id="profile-bio">Sin biografía</p>
                    </div>
                </div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-count" id="profile-albums-count">0</span>
                        <span class="stat-label">Álbumes</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-count" id="profile-tracks-count">0</span>
                        <span class="stat-label">Canciones</span>
                    </div>
                </div>
                <div class="profile-actions">
                    <button id="edit-profile-btn" class="secondary-btn">
                        <i class="fas fa-edit"></i> Editar Perfil
                    </button>
                </div>
            </div>
            <div id="profile-edit" class="profile-edit-container" style="display: none;">
                <form id="profile-edit-form">
                    <div class="form-group">
                        <label for="edit-username">Nombre de Usuario</label>
                        <input type="text" id="edit-username" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-bio">Biografía</label>
                        <textarea id="edit-bio" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-avatar">Avatar</label>
                        <div class="file-upload-container">
                            <label for="edit-avatar" class="file-upload-btn">
                                <i class="fas fa-upload"></i> Seleccionar imagen
                            </label>
                            <input type="file" id="edit-avatar" accept="image/*">
                            <small class="file-name">Ningún archivo seleccionado</small>
                        </div>
                        <div class="avatar-preview-container">
                            <img id="avatar-preview" src="images/placeholder.jpg" alt="Vista previa del avatar" class="avatar-preview">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" id="cancel-profile-edit" class="secondary-btn">Cancelar</button>
                        <button type="submit" class="primary-btn">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Plantilla para nuevas pistas (no visible) -->
    <template id="track-template">
        <div class="track-item">
            <div class="track-details">
                <input type="text" class="track-title-input" placeholder="Título de la canción" required>
                <div class="file-upload-container">
                    <label for="track-file-${index}" class="file-upload-btn">
                        <i class="fas fa-upload"></i> Seleccionar audio
                    </label>
                    <input type="file" id="track-file-${index}" class="track-file" accept="audio/*" required>
                    <small class="track-filename">Ningún archivo seleccionado</small>
                </div>
            </div>
            <button type="button" class="remove-track-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </template>

    <!-- Plantilla para item en la lista de pistas (vista detallada) -->
    <template id="track-list-item-template">
        <div class="track-list-item">
            <div class="track-number"></div>
            <div class="track-info">
                <span class="track-list-title"></span>
            </div>
            <div class="track-actions">
                <button class="track-play-btn control-btn">
                    <i class="fas fa-play"></i>
                </button>
                <button class="track-edit-btn control-btn">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="track-delete-btn control-btn">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </template>

    <!-- Confirmación de eliminación -->
    <div id="confirm-delete-modal" class="modal">
        <div class="modal-content confirm-modal">
            <h3 id="confirm-delete-message">¿Estás seguro de que quieres eliminar este elemento?</h3>
            <div class="confirm-actions">
                <button id="confirm-delete-cancel" class="secondary-btn">Cancelar</button>
                <button id="confirm-delete-confirm" class="danger-btn">Eliminar</button>
            </div>
        </div>
    </div>

    <script src="js/db.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/player.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
